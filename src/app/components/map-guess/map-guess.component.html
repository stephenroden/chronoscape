<div class="map-guess-container" [class.in-toggle-container]="isInToggleContainer">
  <!-- Map Container -->
  <div class="map-wrapper">
    <!-- Loading State -->
    <div *ngIf="isMapLoading" class="map-loading" role="status" aria-live="polite" aria-label="Loading interactive map">
      <div class="loading-spinner" aria-hidden="true"></div>
      <p>Loading map...</p>
      <p *ngIf="retryCount > 0" class="retry-info">
        Retry attempt {{ retryCount }}/3
      </p>
    </div>

    <!-- Error State -->
    <div *ngIf="mapError" class="map-error" role="alert" aria-live="assertive">
      <div class="error-icon" aria-hidden="true">⚠️</div>
      <p>{{ mapError }}</p>
      <button class="retry-button" (click)="retryMapInitialization()" type="button"
        aria-label="Retry loading the interactive map">
        Retry
      </button>
    </div>

    <!-- Map Container -->
    <div #mapContainer class="leaflet-map-container" [class.map-hidden]="isMapLoading || mapError" role="application"
      aria-label="Interactive world map for location guessing. Click to place your location guess."
      tabindex="0" (keydown)="onMapKeyDown($event)"></div>
  </div>
</div>