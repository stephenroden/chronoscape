<div class="game-container">
  <!-- Skip to main content link for accessibility -->
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  <!-- Game header with progress indicator -->
  <header class="game-header" role="banner">
    <h1 id="game-title">Chronoscape</h1>
    
    <!-- Progress indicator showing current photo out of total (Requirement 1.1, 1.3) -->
    <div class="progress-container" 
         *ngIf="(isGameInProgress$ | async)"
         role="progressbar"
         [attr.aria-valuenow]="(gameProgress$ | async)?.current"
         [attr.aria-valuemin]="1"
         [attr.aria-valuemax]="(gameProgress$ | async)?.total"
         [attr.aria-label]="'Game progress: photo ' + (gameProgress$ | async)?.current + ' of ' + (gameProgress$ | async)?.total">
      <div class="progress-text" aria-hidden="true">
        Photo {{ (gameProgress$ | async)?.current }} of {{ (gameProgress$ | async)?.total }}
      </div>
      <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="(gameProgress$ | async)?.percentage"></div>
      </div>
    </div>
  </header>

  <!-- Game content area -->
  <main class="game-content" id="main-content" role="main">
    <!-- Loading state for game initialization -->
    <section class="game-loading" 
             *ngIf="(isGameNotStarted$ | async) && ((gameLoading$ | async) || (photosLoading$ | async))"
             aria-labelledby="loading-heading">
      <h2 id="loading-heading">Preparing Your Game</h2>
      <div class="loading-container" 
           role="status"
           aria-live="polite"
           aria-label="Loading game">
        <div class="loading-spinner large" aria-hidden="true"></div>
        <p>Loading historical photos...</p>
      </div>
    </section>

    <!-- Game in progress state -->
    <section class="game-play" *ngIf="(isGameInProgress$ | async) && !(showingResults$ | async)" aria-labelledby="game-play-heading">
      <h2 id="game-play-heading" class="sr-only">Game in Progress</h2>
      
      <!-- Photo display component -->
      <div class="photo-section" role="region" aria-labelledby="photo-heading">
        <h3 id="photo-heading" class="sr-only">Historical Photograph</h3>
        <app-photo-display></app-photo-display>
      </div>

      <!-- Guessing components -->
      <div class="guess-container" role="region" aria-labelledby="guessing-heading">
        <h3 id="guessing-heading" class="sr-only">Make Your Guesses</h3>
        
        <div class="year-guess-section" role="region" aria-labelledby="year-guess-heading">
          <h4 id="year-guess-heading" class="sr-only">Year Guess</h4>
          <app-year-guess></app-year-guess>
        </div>
        
        <div class="map-guess-section" role="region" aria-labelledby="location-guess-heading">
          <h4 id="location-guess-heading" class="sr-only">Location Guess</h4>
          <app-map-guess></app-map-guess>
        </div>
      </div>

      <!-- Submit guess button -->
      <div class="submit-container" role="region" aria-label="Submit your guess">
        <button class="primary-button submit-guess-btn" 
                (click)="submitGuess()" 
                [disabled]="!(canSubmitGuess$ | async)"
                type="button"
                [attr.aria-label]="(canSubmitGuess$ | async) ? 'Submit your year and location guess' : 'Complete both year and location guesses to submit'">
          Submit Guess
        </button>
        <p class="submit-help-text" *ngIf="!(canSubmitGuess$ | async)">
          Please make both a year guess and place a pin on the map to submit.
        </p>
      </div>
    </section>

    <!-- Results display after guess submission -->
    <section class="game-results" *ngIf="(isGameInProgress$ | async) && (showingResults$ | async)" aria-labelledby="results-heading">
      <h2 id="results-heading" class="sr-only">Photo Results</h2>
      <app-results (nextPhoto)="onNextPhoto()"></app-results>
    </section>

    <!-- Game completed state - redirect to results -->
    <section class="game-completed" 
             *ngIf="(isGameCompleted$ | async)" 
             aria-labelledby="game-completed-heading"
             role="region">
      <h2 id="game-completed-heading">Game Completed!</h2>
      <p>Redirecting to your results...</p>
      <div class="loading-container">
        <div class="loading-spinner" aria-hidden="true"></div>
      </div>
    </section>

    <!-- Error states -->
    <section class="game-error" 
             *ngIf="(hasGameError$ | async) || (photosError$ | async) || (scoringError$ | async)"
             role="alert"
             aria-labelledby="error-heading">
      <div class="error-icon" aria-hidden="true">⚠️</div>
      <h2 id="error-heading">Oops! Something went wrong</h2>
      
      <!-- Game error -->
      <div *ngIf="gameError$ | async as gameError" class="error-message">
        <p>{{ getErrorMessage(gameError) }}</p>
        <div class="error-actions">
          <button 
            class="primary-button" 
            (click)="clearGameError()"
            *ngIf="isRetryableError(gameError)"
            type="button"
            aria-label="Try to resolve the game error">
            Try Again
          </button>
          <button 
            class="secondary-button" 
            (click)="resetGame()"
            type="button"
            aria-label="Restart the entire game">
            Restart Game
          </button>
        </div>
      </div>
      
      <!-- Photos error -->
      <div *ngIf="photosError$ | async as photosError" class="error-message">
        <p>{{ getErrorMessage(photosError) }}</p>
        <div class="error-actions">
          <button 
            class="primary-button" 
            (click)="retryLoadPhotos()"
            *ngIf="isRetryableError(photosError)"
            type="button"
            aria-label="Retry loading photos from the server">
            Retry Loading Photos
          </button>
          <button 
            class="secondary-button" 
            (click)="resetGame()"
            type="button"
            aria-label="Restart the entire game">
            Restart Game
          </button>
        </div>
      </div>
      
      <!-- Scoring error -->
      <div *ngIf="scoringError$ | async as scoringError" class="error-message">
        <p>{{ getErrorMessage(scoringError) }}</p>
        <div class="error-actions">
          <button 
            class="secondary-button" 
            (click)="resetGame()"
            type="button"
            aria-label="Restart the entire game">
            Restart Game
          </button>
        </div>
      </div>
    </section>

    <!-- Loading overlay for ongoing operations -->
    <div class="loading-overlay" 
         *ngIf="(gameLoading$ | async) || (photosLoading$ | async) || (scoringLoading$ | async)"
         role="status"
         aria-live="polite"
         [attr.aria-label]="getLoadingMessage()">
      <div class="loading-content">
        <div class="loading-spinner large" aria-hidden="true"></div>
        <p *ngIf="photosLoading$ | async">Loading photos...</p>
        <p *ngIf="scoringLoading$ | async">Calculating score...</p>
        <p *ngIf="gameLoading$ | async">Loading game...</p>
      </div>
    </div>
  </main>
</div>